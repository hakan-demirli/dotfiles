#!/usr/bin/env bash

input=$(cat)

if [ -z "$input" ]; then
  exit 0
fi

if [ -n "$WAYLAND_DISPLAY" ] && command -v wl-copy &> /dev/null; then
  printf "%s" "$input" | wl-copy
  exit 0
fi

if [ -n "$DISPLAY" ] && command -v xclip &> /dev/null; then
  printf "%s" "$input" | xclip -selection clipboard
  exit 0
elif [ -n "$DISPLAY" ] && command -v xsel &> /dev/null; then
  printf "%s" "$input" | xsel --clipboard --input
  exit 0
fi

if [[ $OSTYPE == "darwin"* ]] && command -v pbcopy &> /dev/null; then
  printf "%s" "$input" | pbcopy
  exit 0
fi

if grep -q "Microsoft" /proc/version 2> /dev/null && command -v clip.exe &> /dev/null; then
  printf "%s" "$input" | clip.exe
  exit 0
fi

b64_data=$(printf "%s" "$input" | base64 | tr -d '\n')

if [ -n "$TMUX" ]; then
  printf "\033Ptmux;\033\033]52;c;%s\007\033\\" "$b64_data"
else
  printf "\033]52;c;%s\007" "$b64_data"
fi
